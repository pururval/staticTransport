<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Simple markers</title>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>

    <div id="map"></div>
    <script>
		var googleMap;
		var BusStops = [
		  ['1', 43.008204, -78.785880],
		  ['2', 43.001946, -78.785752],
		  ['3', 43.002120, -78.793448],
		  ['4', 43.000153, -78.789152],
		  ['5', 42.992871, -78.792277],
		];
		
		var busgap = 
			["5","7","8","1","6","3"];
		
		var buses = [
		['b1',"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"]
		,['b2',"http://maps.google.com/mapfiles/ms/icons/red-dot.png"]];

		var busMarker = [];

		function initMap() {
			googleMap = new google.maps.Map(document.getElementById('map'), {
				center: {lat: 43.000153, lng: -78.789152},
				zoom: 15
			});
			smos(googleMap);	  
		}

		function setLocations(map,BusStops) {
			AddMarker(map,BusStops,"7","43",buses[0][1]);
			AddMarker(map,BusStops,"7","44",buses[1][1]);
		}
		
		function AddMarker(map,BusStops,hr,min,busIc){
			var now = new Date();
			var millis = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hr, min, 0, 0) - now;
			if (millis < 0) {
				millis += 86400000; 
			}
			var myAmot = setTimeout(function(){amot(map,BusStops,busIc)}, millis);
		}
	
		function amot(map,BusStops,busIc){
			var marker = new google.maps.Marker({
				position: new google.maps.LatLng(BusStops[0][1],BusStops[0][2]),
				map: map,
				icon: busIc
			});
			busMarker.push(marker);
			var s1 = setTimeout(function(){moveBusTo1(map,marker)}, 5000);
		}
		
		function moveBusTo1( map, marker ) {
			marker.setPosition( new google.maps.LatLng( BusStops[1][1], BusStops[1][2] ) );
			map.panTo( new google.maps.LatLng( BusStops[1][1], BusStops[1][2] ) );
			var s2 = setTimeout(function(){moveBusTo2(map,marker)}, 7000);
		};
		
		function moveBusTo2( map, marker ) {
			marker.setPosition( new google.maps.LatLng( BusStops[2][1], BusStops[2][2] ) );
			map.panTo( new google.maps.LatLng( BusStops[2][1], BusStops[2][2] ) );
			var s3 = setTimeout(function(){moveBusTo3(map,marker)}, 5000);
		};
		
		function moveBusTo3( map, marker ) {
			marker.setPosition( new google.maps.LatLng( BusStops[3][1], BusStops[3][2] ) );
			map.panTo( new google.maps.LatLng( BusStops[3][1], BusStops[3][2] ) );
			var s4 = setTimeout(function(){moveBusTo4(map,marker)}, 5000);
		};
		
		function moveBusTo4( map, marker ) {
			marker.setPosition( new google.maps.LatLng( BusStops[4][1], BusStops[4][2] ) );
			map.panTo( new google.maps.LatLng( BusStops[4][1], BusStops[4][2] ) );
			//var s4 = setTimeout(function(){moveBusTo4(map,marker)}, 5000);
		};

		function smos(map) {
			setLocations(map,BusStops);
			for (var i = 0; i < busMarker.length; i++) {
				busMarker[i].setMap(map);
			}
		}

		function clearLocations() {
			smos(null);
		}

		function showLocations() {
			smos(googleMap);
		}
	</script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBfzLK-C_jik22yCDp6oOQg4nnbkC2DYA0&callback=initMap">
    </script>
  </body>
</html>
