<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Simple markers</title>
      <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>

    <div id="map"></div>
    <script>
		var googleMap;
    var BusStops = [
      ['1', 43.008204, -78.785880], //ellicot
      ['2', 43.008204, -78.785880],
      ['3', 43.009153, -78.785902],
      ['4', 43.009224, -78.785237],
      ['5', 43.009224, -78.784743],
      ['6', 43.009216, -78.784056],
      ['7', 43.009228, -78.783495],
      ['8', 43.009228, -78.783173],
      ['9', 43.009369, -78.783173],
      ['10', 43.009549, -78.783184],
      ['11', 43.009533, -78.782766],
      ['12', 43.009549, -78.782423],
      ['13', 43.009510, -78.781951],
      ['14', 43.009259, -78.781908],
      ['15', 43.009047, -78.781876],
      ['16', 43.008874, -78.781844],
      ['17', 43.008678, -78.781782],
      ['18', 43.008521, -78.781750],
      ['19', 43.008223, -78.781632],
      ['20', 43.007972, -78.781493],
      ['21', 43.007697, -78.781386],
      ['22', 43.007438, -78.781783],
      ['23', 43.007250, -78.782040],
      ['24', 43.007124, -78.782201],
      ['25', 43.007022, -78.782383],
      ['26', 43.006826, -78.782576],
      ['27', 43.006630, -78.782898],
      ['28', 43.006457, -78.783188],
      ['29', 43.006292, -78.783499],
      ['30', 43.006166, -78.783864],
      ['31', 43.006033, -78.784143],
      ['32', 43.005923, -78.784497],
      ['33', 43.005821, -78.784862],
      ['34', 43.005644, -78.785184],
      ['35', 43.005550, -78.785581],
      ['36', 43.005597, -78.785924],
      ['37', 43.005401, -78.786128],
      ['38', 43.005268, -78.785983],
      ['39', 43.005107, -78.785956],
      ['40', 43.004868, -78.785945],
      ['41', 43.004656, -78.785934],
      ['42', 43.004503, -78.785945],
      ['43', 43.004354, -78.785966],
      ['44', 43.004201, -78.785955],
      ['45', 43.004060, -78.785939],
      ['46', 43.003919, -78.785939],
      ['47', 43.003766, -78.785944],
      ['48', 43.003652, -78.785906],
      ['49', 43.003432, -78.785922],
      ['50', 43.003283, -78.785949],
      ['51', 43.003118, -78.785917],
      ['52', 43.002992, -78.785917],
      ['53', 43.002894, -78.785917],
      ['54', 43.002800, -78.785917],
      ['55', 43.002671, -78.785901],
      ['56', 43.002549, -78.785912],
      ['57', 43.002449, -78.785912],
      ['58', 43.002349, -78.785912],
      ['59', 43.002249, -78.785912],
      ['60', 43.002149, -78.785912],
      ['61', 43.002049, -78.785912],
      ['62', 43.001946, -78.785752], //lee loop
      ['63', 43.002120, -78.793448], //governors
      ['64', 43.000153, -78.789152], //flint
      ['65', 42.992871, -78.792277], //service road
    ];

		// var busgap =
		// 	["5","7","8","1","6","3"];

		var buses = [
		['b1',"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"]
		,['b2',"http://maps.google.com/mapfiles/ms/icons/red-dot.png"]];

		var busMarker = [];

    var i= 1;

		function initMap() {
			googleMap = new google.maps.Map(document.getElementById('map'), {
				center: {lat: 43.000153, lng: -78.789152},
				zoom: 15
			});
			smos(googleMap);
		}



		function setLocations(map,BusStops) {
			AddMarker(map,BusStops,"1","31",buses[0][1]);
			AddMarker(map,BusStops,"1","32",buses[1][1]);
		}

		function AddMarker(map,BusStops,hr,min,busIc){
			var now = new Date();
			var millis = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hr, min, now.getSeconds(), now.getMilliseconds()) - now;
			if (millis < 0) {
				millis += 864.00000;
			}
			var myAmot = setTimeout(function(){amot(map,BusStops,busIc)}, millis);
		}

		function amot(map,BusStops,busIc){    //add marker on time
			var marker = new google.maps.Marker({
				position: new google.maps.LatLng(BusStops[0][1],BusStops[0][2]),
				map: map,
				icon: busIc
			});
			busMarker.push(marker);
			// var s1 = setTimeout(function(){moveBusTo1(map,marker)}, 500);
      var s1 = setTimeout(function(){moveBus(map,marker)}, 500);

		}

		function moveBusTo1( map, marker ) {
			marker.setPosition( new google.maps.LatLng( BusStops[1][1], BusStops[1][2] ) );
			// map.panTo( new google.maps.LatLng( BusStops[1][1], BusStops[1][2] ) );
			var s2 = setTimeout(function(){moveBusTo2(map,marker)}, 500);
		};

		function moveBusTo2( map, marker ) {
			marker.setPosition( new google.maps.LatLng( BusStops[2][1], BusStops[2][2] ) );
			// map.panTo( new google.maps.LatLng( BusStops[2][1], BusStops[2][2] ) );
			var s3 = setTimeout(function(){moveBusTo3(map,marker)}, 500);
		};

		function moveBusTo3( map, marker ) {
			marker.setPosition( new google.maps.LatLng( BusStops[3][1], BusStops[3][2] ) );
			// map.panTo( new google.maps.LatLng( BusStops[3][1], BusStops[3][2] ) );
			var s4 = setTimeout(function(){moveBusTo4(map,marker)}, 500);
		};

		function moveBusTo4( map, marker ) {
			marker.setPosition( new google.maps.LatLng( BusStops[4][1], BusStops[4][2] ) );
			// map.panTo( new google.maps.LatLng( BusStops[4][1], BusStops[4][2] ) );
			var s5 = setTimeout(function(){moveBusTo5(map,marker)}, 500);
		};

    function moveBusTo5( map, marker ) {
			marker.setPosition( new google.maps.LatLng( BusStops[0][1], BusStops[0][2] ) );
			// map.panTo( new google.maps.LatLng( BusStops[4][1], BusStops[4][2] ) );
			var s5 = setTimeout(function(){moveBusTo1(map,marker)}, 500);
		};

    // function moveBus(map, marker){
    //   marker.setPosition( new google.maps.LatLng( BusStops[i][1], BusStops[i][2] ) );
    //   i+=1;
    //   if(i>62){
    //     i=0;
    //   }
    //   var s5 = setTimeout(function(){moveBus(map,marker)}, 500);
    // }


		function smos(map) {   // set marker on spot
			setLocations(map,BusStops);
			for (var i = 0; i < busMarker.length; i++) {
				busMarker[i].setMap(map);
			}
		}

		function clearLocations() {
			smos(null);
		}

		function showLocations() {
			smos(googleMap);
		}
	</script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBfzLK-C_jik22yCDp6oOQg4nnbkC2DYA0&callback=initMap">
    </script>
  </body>
</html>
